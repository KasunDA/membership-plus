//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool from CryptoGateway Software Inc.
//     Tool name: CGW X-Script RDB visual Layer Generator
//
//     Archymeta Information Technologies Co., Ltd.
//
//     Changes to this file, could be overwritten if the code is re-generated.
//     Add (if not yet) a code-manager node to the generator to specify 
//     how existing files are processed.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Configuration;
using System.Collections.Generic;
using System.Reflection;
using System.Linq;
using System.Linq.Expressions;
using System.Threading;
using System.Runtime.Serialization;
using System.ComponentModel.DataAnnotations;
using System.Runtime.Serialization.Json;

namespace CryptoGateway.RDB.Data.MembershipPlus
{
    /// <summary>
    /// A entity in "UsersInRoles" data set.
    /// </summary>
    /// <remarks>
    ///  <para>
    ///    Properties of the entity are categorized in the following:
    ///  </para>
    ///  <list type="table">
    ///    <listheader>
    ///       <term>Primary keys</term><description>Description</description>
    ///    </listheader>
    ///    <item>
    ///      <term>RoleID</term>
    ///      <description>See <see cref="UsersInRole.RoleID" />. Primary key; intrinsic id; fixed; not null; foreign key.</description>
    ///    </item>
    ///    <item>
    ///      <term>UserID</term>
    ///      <description>See <see cref="UsersInRole.UserID" />. Primary key; intrinsic id; fixed; not null; foreign key.</description>
    ///    </item>
    ///  </list>
    ///  <list type="table">
    ///    <listheader>
    ///       <term>Intrinsic Identifiers</term><description>Description</description>
    ///    </listheader>
    ///    <item>
    ///      <term>RoleID</term>
    ///      <description>See <see cref="UsersInRole.RoleID" />. Primary key; intrinsic id; fixed; not null; foreign key.</description>
    ///    </item>
    ///    <item>
    ///      <term>UserID</term>
    ///      <description>See <see cref="UsersInRole.UserID" />. Primary key; intrinsic id; fixed; not null; foreign key.</description>
    ///    </item>
    ///  </list>
    ///  <list type="table">
    ///    <listheader>
    ///       <term>None editable properties</term><description>Description</description>
    ///    </listheader>
    ///    <item>
    ///      <term>AssignDate</term>
    ///      <description>See <see cref="UsersInRole.AssignDate" />. Fixed; not null.</description>
    ///    </item>
    ///  </list>
    ///  <list type="table">
    ///    <listheader>
    ///       <term>Editable properties</term><description>Description</description>
    ///    </listheader>
    ///    <item>
    ///      <term>SubPriority</term>
    ///      <description>See <see cref="UsersInRole.SubPriority" />. Editable; not null.</description>
    ///    </item>
    ///    <item>
    ///      <term>LastModified</term>
    ///      <description>See <see cref="UsersInRole.LastModified" />. Editable; nullable.</description>
    ///    </item>
    ///  </list>
    ///  <list type="table">
    ///    <listheader>
    ///       <term>Foreign keys</term><description>Description</description>
    ///    </listheader>
    ///    <item>
    ///      <term>RoleID</term>
    ///      <description>See <see cref="UsersInRole.RoleID" />. Primary key; intrinsic id; fixed; not null; foreign key.</description>
    ///    </item>
    ///    <item>
    ///      <term>UserID</term>
    ///      <description>See <see cref="UsersInRole.UserID" />. Primary key; intrinsic id; fixed; not null; foreign key.</description>
    ///    </item>
    ///    <item>
    ///      <term>AdminID</term>
    ///      <description>See <see cref="UsersInRole.AdminID" />. Editable; nullable; foreign key.</description>
    ///    </item>
    ///  </list>
    ///  <list type="table">
    ///    <listheader>
    ///       <term>This entity depends on</term><description>Description</description>
    ///    </listheader>
    ///    <item>
    ///      <term>RoleRef</term>
    ///      <description>See <see cref="UsersInRole.RoleRef" />, which is a member of the data set "Roles" for <see cref="Role" />.</description>
    ///    </item>
    ///    <item>
    ///      <term>User_UserID</term>
    ///      <description>See <see cref="UsersInRole.User_UserID" />, which is a member of the data set "Users" for <see cref="User" />.</description>
    ///    </item>
    ///    <item>
    ///      <term>User_AdminID</term>
    ///      <description>See <see cref="UsersInRole.User_AdminID" />, which is a member of the data set "Users" for <see cref="User" />. Nullable.</description>
    ///    </item>
    ///  </list>
    /// </remarks>
    [DataContract]
    [Serializable]
    public class UsersInRole : IDbEntity 
    {
        /// <summary>
        /// For internal use only.
        /// </summary>
        public bool IsOperationHandled = false;

        /// <summary>
        /// Used on the server side to return an unique key for caching purposes.
        /// </summary>
        public string CacheKey
        {
            get
            {
                return this.RoleID.ToString() + ":" + this.UserID;
            }
        }

        /// <summary>
        /// Whether or not the entity was already persisted into to the data source. 
        /// </summary>
        [DataMember]
        public bool IsPersisted
        {
            get { return _isPersisted; }
            set { _isPersisted = value; }
        }
        private bool _isPersisted = false;

        /// <summary>
        /// Used internally.
        /// </summary>
        public bool StartAutoUpdating
        {
            get { return _startAutoUpdating; }
            set { _startAutoUpdating = value; }
        }
        private bool _startAutoUpdating = false;

        /// <summary>
        /// Used to matching entities in input adding or updating entity list and the returned ones, see <see cref="IUsersInRoleService.AddOrUpdateEntities" />.
        /// </summary>
        [DataMember]
        public int UpdateIndex
        {
            get { return _updateIndex; }
            set { _updateIndex = value; }
        }
        private int _updateIndex = -1;

        /// <summary>
        /// Its value provides a list of value for intrinsic keys and modified properties.
        /// </summary>
        public string SignatureString 
        { 
            get
            {
                string str = "";
                str += "RoleID = " + RoleID + "\r\n";
                str += "UserID = " + UserID + "\r\n";
                if (IsSubPriorityModified)
                    str += "Modified [SubPriority] = " + SubPriority + "\r\n";
                if (IsLastModifiedModified)
                    str += "Modified [LastModified] = " + LastModified + "\r\n";
                if (IsAdminIDModified)
                    str += "Modified [AdminID] = " + AdminID + "\r\n";;
                return str.Trim();
            }
        }

        /// <summary>
        /// Configured at system generation step, its value provides a short, but characteristic summary of the entity.
        /// </summary>
        [DataMember]
        public string DistinctString
        {
            get 
            {
                if (_distinctString == null)
                    _distinctString = GetDistinctString(true);
                return _distinctString;
            }
            set
            {
                _distinctString = value;
            }
        }
        private string _distinctString = null;

        private string GetDistinctString(bool ShowPathInfo)
        {
            LoadUser_UserID();
            LoadRoleRef();
            return String.Format(@"{0} as {1}", (User_UserID != null ? User_UserID.DistinctString : ""), (RoleRef != null ? RoleRef.DistinctString : ""));
        }

        /// <summary>
        /// Whether or not the entity was edited.
        /// </summary>
        [DataMember]
        public bool IsEntityChanged
        {
            get { return _isEntityChanged; }
            set { _isEntityChanged = value; }
        }
        private bool _isEntityChanged = true;

        /// <summary>
        /// Whether or not the entity was to be deleted.
        /// </summary>
        [DataMember]
        public bool IsDeleted
        {
            get { return _isDeleted; }
            set { _isDeleted = value; }
        }
        private bool _isDeleted = false;

#region constructors and serialization

        /// <summary>
        /// Default constructor.
        /// </summary>
        public UsersInRole()
        {
        }

        /// <summary>
        /// Constructor for serialization (<see cref="ISerializable" />).
        /// </summary>
        public UsersInRole(SerializationInfo info, StreamingContext context)
        {
            DataContractJsonSerializer ser = new DataContractJsonSerializer(typeof(UsersInRole));
            var strm = new System.IO.MemoryStream();
            byte[] bf = (byte[])info.GetValue("data", typeof(byte[]));
            strm.Write(bf, 0, bf.Length);
            strm.Position = 0;
            var e = ser.ReadObject(strm) as UsersInRole;
            IsPersisted = false;
            StartAutoUpdating = false;
            MergeChanges(e, this);
            StartAutoUpdating = true;
        }

        /// <summary>
        /// Implementation of the <see cref="ISerializable" /> interface
        /// </summary>
        /// <param name="info"></param>
        /// <param name="context"></param>
        public void GetObjectData(SerializationInfo info, StreamingContext context)
        {
            DataContractJsonSerializer ser = new DataContractJsonSerializer(typeof(UsersInRole));
            var strm = new System.IO.MemoryStream();
            ser.WriteObject(strm, ShallowCopy());
            info.AddValue("data", strm.ToArray(), typeof(byte[]));
        }

#endregion

#region Properties of the current entity

        /// <summary>
        /// Meta-info: primary key; intrinsic id; fixed; not null; foreign key.
        /// </summary>
        [Key]
        [Required]
        [Editable(false)]
        [DataMember(IsRequired = true)]
        public int RoleID
        { 
            get
            {
                return _RoleID;
            }
            set
            {
                if (_RoleID != value)
                {
                    _RoleID = value;
                }
            }
        }
        private int _RoleID = default(int);

        /// <summary>
        /// Meta-info: primary key; intrinsic id; fixed; not null; foreign key.
        /// </summary>
        [Key]
        [Editable(false)]
        [DataMember(IsRequired = true)]
        public string UserID
        { 
            get
            {
                return _UserID;
            }
            set
            {
                if (_UserID != value)
                {
                    _UserID = value;
                }
            }
        }
        private string _UserID = default(string);

        /// <summary>
        /// Meta-info: fixed; not null.
        /// </summary>
        [Required]
        [Editable(false)]
        [DataMember(IsRequired = true)]
        public DateTime AssignDate
        { 
            get
            {
                return _AssignDate;
            }
            set
            {
                if (_AssignDate != value)
                {
                    _AssignDate = value;
                }
            }
        }
        private DateTime _AssignDate = default(DateTime);

        /// <summary>
        /// Meta-info: editable; not null.
        /// </summary>
        [Required]
        [Editable(true)]
        [DataMember(IsRequired = true)]
        public int SubPriority
        { 
            get
            {
                return _SubPriority;
            }
            set
            {
                if (_SubPriority != value)
                {
                    _SubPriority = value;
                    if (StartAutoUpdating)
                        IsSubPriorityModified = true;
                }
            }
        }
        private int _SubPriority = default(int);

        /// <summary>
        /// Wether or not the value of <see cref="SubPriority" /> was changed compared to what it was loaded last time. 
        /// Note: the backend data source updates the changed <see cref="SubPriority" /> only if this is set to true no matter what
        /// the actual value of <see cref="SubPriority" /> is.
        /// </summary>
        [DataMember]
        public bool IsSubPriorityModified
        { 
            get
            {
                return _isSubPriorityModified;
            }
            set
            {
                _isSubPriorityModified = value;
            }
        }
        private bool _isSubPriorityModified = false;

        /// <summary>
        /// Meta-info: editable; nullable.
        /// </summary>
        [Editable(true)]
        [DataMember(IsRequired = false)]
        public System.Nullable<DateTime> LastModified
        { 
            get
            {
                return _LastModified;
            }
            set
            {
                if (_LastModified != value)
                {
                    _LastModified = value;
                    if (StartAutoUpdating)
                        IsLastModifiedModified = true;
                }
            }
        }
        private System.Nullable<DateTime> _LastModified = default(System.Nullable<DateTime>);

        /// <summary>
        /// Wether or not the value of <see cref="LastModified" /> was changed compared to what it was loaded last time. 
        /// Note: the backend data source updates the changed <see cref="LastModified" /> only if this is set to true no matter what
        /// the actual value of <see cref="LastModified" /> is.
        /// </summary>
        [DataMember]
        public bool IsLastModifiedModified
        { 
            get
            {
                return _isLastModifiedModified;
            }
            set
            {
                _isLastModifiedModified = value;
            }
        }
        private bool _isLastModifiedModified = false;

        /// <summary>
        /// Meta-info: editable; nullable; foreign key.
        /// </summary>
        [Editable(true)]
        [DataMember(IsRequired = false)]
        public string AdminID
        { 
            get
            {
                return _AdminID;
            }
            set
            {
                if (_AdminID != value)
                {
                    _AdminID = value;
                    if (StartAutoUpdating)
                        IsAdminIDModified = true;
                }
            }
        }
        private string _AdminID = default(string);

        /// <summary>
        /// Wether or not the value of <see cref="AdminID" /> was changed compared to what it was loaded last time. 
        /// Note: the backend data source updates the changed <see cref="AdminID" /> only if this is set to true no matter what
        /// the actual value of <see cref="AdminID" /> is.
        /// </summary>
        [DataMember]
        public bool IsAdminIDModified
        { 
            get
            {
                return _isAdminIDModified;
            }
            set
            {
                _isAdminIDModified = value;
            }
        }
        private bool _isAdminIDModified = false;

#endregion

#region Entities that the current one depends upon.

        /// <summary>
        /// Entity in data set "Roles" for <see cref="Role" /> that this entity depend upon through .
        /// The corresponding foreign key set is { <see cref="UsersInRole.RoleID" /> }.
        /// </summary>
        [DataMember]
        public Role RoleRef
        {
            get 
            {
                if (_RoleRef == null && AutoLoadRoleRef != null)
                    _RoleRef = AutoLoadRoleRef();
                return _RoleRef; 
            }
            set 
            { 
                _RoleRef = value; 
            }
        }
        private Role _RoleRef = null;

        /// <summary>
        /// <see cref="UsersInRole.RoleRef" /> is not initialized when the entity is created. Clients could call this method to load it provided a proper delegate <see cref="UsersInRole.DelLoadRoleRef" /> was setup
        /// before calling it.
        /// </summary>
        public void LoadRoleRef()
        {
            if (_RoleRef != null)
                return;
            if (DelLoadRoleRef != null)
                _RoleRef = DelLoadRoleRef();
        }

        /// <summary>
        /// A delegate to load <see cref="UsersInRole.RoleRef" />.
        /// </summary>
        public Func<Role> DelLoadRoleRef = null;

        /// <summary>
        /// A delegate to load <see cref="UsersInRole.RoleRef" /> automatically when it is referred to at the first time.
        /// </summary>
        public Func<Role> AutoLoadRoleRef = null;

        /// <summary>
        /// Entity in data set "Users" for <see cref="User" /> that this entity depend upon through .
        /// The corresponding foreign key set is { <see cref="UsersInRole.UserID" /> }.
        /// </summary>
        [DataMember]
        public User User_UserID
        {
            get 
            {
                if (_User_UserID == null && AutoLoadUser_UserID != null)
                    _User_UserID = AutoLoadUser_UserID();
                return _User_UserID; 
            }
            set 
            { 
                _User_UserID = value; 
            }
        }
        private User _User_UserID = null;

        /// <summary>
        /// <see cref="UsersInRole.User_UserID" /> is not initialized when the entity is created. Clients could call this method to load it provided a proper delegate <see cref="UsersInRole.DelLoadUser_UserID" /> was setup
        /// before calling it.
        /// </summary>
        public void LoadUser_UserID()
        {
            if (_User_UserID != null)
                return;
            if (DelLoadUser_UserID != null)
                _User_UserID = DelLoadUser_UserID();
        }

        /// <summary>
        /// A delegate to load <see cref="UsersInRole.User_UserID" />.
        /// </summary>
        public Func<User> DelLoadUser_UserID = null;

        /// <summary>
        /// A delegate to load <see cref="UsersInRole.User_UserID" /> automatically when it is referred to at the first time.
        /// </summary>
        public Func<User> AutoLoadUser_UserID = null;

        /// <summary>
        /// Entity in data set "Users" for <see cref="User" /> that this entity depend upon through .
        /// The corresponding foreign key set is { <see cref="UsersInRole.AdminID" /> }.
        /// </summary>
        [DataMember]
        public User User_AdminID
        {
            get 
            {
                if (AdminID == null)
                    return null;
                else if (_User_AdminID == null && AutoLoadUser_AdminID != null)
                    _User_AdminID = AutoLoadUser_AdminID();
                return _User_AdminID; 
            }
            set 
            { 
                _User_AdminID = value; 
            }
        }
        private User _User_AdminID = null;

        /// <summary>
        /// <see cref="UsersInRole.User_AdminID" /> is not initialized when the entity is created. Clients could call this method to load it provided a proper delegate <see cref="UsersInRole.DelLoadUser_AdminID" /> was setup
        /// before calling it.
        /// </summary>
        public void LoadUser_AdminID()
        {
            if (AdminID == null || _User_AdminID != null)
                return;
            if (DelLoadUser_AdminID != null)
                _User_AdminID = DelLoadUser_AdminID();
        }

        /// <summary>
        /// A delegate to load <see cref="UsersInRole.User_AdminID" />.
        /// </summary>
        public Func<User> DelLoadUser_AdminID = null;

        /// <summary>
        /// A delegate to load <see cref="UsersInRole.User_AdminID" /> automatically when it is referred to at the first time.
        /// </summary>
        public Func<User> AutoLoadUser_AdminID = null;

#endregion

#region Entities that depend on the current one.

#endregion

        /// <summary>
        /// Whether or not the present entity is identitical to <paramref name="other" />, in the sense that they have the same (set of) primary key(s).
        /// </summary>
        /// <param name="other">The entity to be compared to.</param>
        /// <returns>
        ///   The result of comparison.
        /// </returns>
        public bool IsEntityIdentical(UsersInRole other)
        {
            if (other == null)
                return false;
            if (RoleID != other.RoleID)
                return false;
            if (UserID != other.UserID)
                return false;
            return true;
        }              

        /// <summary>
        /// Whether or not the present entity is identitical to <paramref name="other" />, in the sense that they have the same (set of) intrinsic identifiers.
        /// </summary>
        /// <param name="other">The entity to be compared to.</param>
        /// <returns>
        ///   The result of comparison.
        /// </returns>
        public bool IsEntityTheSame(UsersInRole other)
        {
            if (other == null)
                return false;
            else
                return RoleID == other.RoleID &&  UserID == other.UserID;
        }              

        /// <summary>
        /// Merge changes inside entity <paramref name="from" /> to the entity <paramref name="to" />. Any changes in <paramref name="from" /> that is not changed in <paramref name="to" /> is updated inside <paramref name="to" />.
        /// </summary>
        /// <param name="from">The "old" entity acting as merging source.</param>
        /// <param name="to">The "new" entity which inherits changes made in <paramref name="from" />.</param>
        /// <returns>
        /// </returns>
        public static void MergeChanges(UsersInRole from, UsersInRole to)
        {
            if (to.IsPersisted)
            {
                if (from.IsSubPriorityModified && !to.IsSubPriorityModified)
                {
                    to.SubPriority = from.SubPriority;
                    to.IsSubPriorityModified = true;
                }
                if (from.IsLastModifiedModified && !to.IsLastModifiedModified)
                {
                    to.LastModified = from.LastModified;
                    to.IsLastModifiedModified = true;
                }
                if (from.IsAdminIDModified && !to.IsAdminIDModified)
                {
                    to.AdminID = from.AdminID;
                    to.IsAdminIDModified = true;
                }
            }
            else
            {
                to.IsPersisted = from.IsPersisted;
                to.RoleID = from.RoleID;
                to.UserID = from.UserID;
                to.AssignDate = from.AssignDate;
                to.SubPriority = from.SubPriority;
                to.IsSubPriorityModified = from.IsSubPriorityModified;
                to.LastModified = from.LastModified;
                to.IsLastModifiedModified = from.IsLastModifiedModified;
                to.AdminID = from.AdminID;
                to.IsAdminIDModified = from.IsAdminIDModified;
            }
        }

        /// <summary>
        /// Update changes to the current entity compared to an input <paramref name="newdata" /> and set the entity to a proper state for updating.
        /// </summary>
        /// <param name="newdata">The "new" entity acting as the source of the changes, if any.</param>
        /// <returns>
        /// </returns>
        public void UpdateChanges(UsersInRole newdata)
        {
            int cnt = 0;
            if (SubPriority != newdata.SubPriority)
            {
                SubPriority = newdata.SubPriority;
                IsSubPriorityModified = true;
                cnt++;
            }
            if (LastModified != newdata.LastModified)
            {
                LastModified = newdata.LastModified;
                IsLastModifiedModified = true;
                cnt++;
            }
            IsEntityChanged = cnt > 0;
        }

        /// <summary>
        /// Internal use
        /// </summary>
        public void NormalizeValues()
        {
            StartAutoUpdating = false;
            if (!IsEntityChanged)
                IsEntityChanged = IsSubPriorityModified || IsLastModifiedModified || IsAdminIDModified;
            StartAutoUpdating = true;
        }

        /// <summary>
        /// Make a shallow copy of the entity.
        /// </summary>
        IDbEntity IDbEntity.ShallowCopy(bool preserveState)
        {
            return ShallowCopy(false, preserveState);
        }

        /// <summary>
        /// Internal use
        /// </summary>
        public UsersInRole ShallowCopy(bool allData = false, bool preserveState = false, bool checkLoadState = false)
        {
            UsersInRole e = new UsersInRole();
            e.StartAutoUpdating = false;
            e.RoleID = RoleID;
            e.UserID = UserID;
            e.AssignDate = AssignDate;
            e.SubPriority = SubPriority;
            if (preserveState)
                e.IsSubPriorityModified = IsSubPriorityModified;
            else
                e.IsSubPriorityModified = false;
            e.LastModified = LastModified;
            if (preserveState)
                e.IsLastModifiedModified = IsLastModifiedModified;
            else
                e.IsLastModifiedModified = false;
            e.AdminID = AdminID;
            if (preserveState)
                e.IsAdminIDModified = IsAdminIDModified;
            else
                e.IsAdminIDModified = false;
            e.DistinctString = GetDistinctString(true);
            e.IsPersisted = IsPersisted;
            if (preserveState)
                e.IsEntityChanged = IsEntityChanged;
            else
                e.IsEntityChanged = false;
            e.StartAutoUpdating = true;
            return e;
        }

        /// <summary>
        /// A textual representation of the entity.
        /// </summary>
        public override string ToString()
        {
            System.Text.StringBuilder sb = new System.Text.StringBuilder();
            sb.Append(@"
----===== [[UsersInRole]] =====----
  RoleID = " + RoleID + @"");
            sb.Append(@" (natural id)");
            sb.Append(@"
  UserID = '" + UserID + @"'");
            sb.Append(@" (natural id)");
            sb.Append(@"
  AssignDate = " + AssignDate + @"
  SubPriority = " + SubPriority + @"");
            if (IsSubPriorityModified)
                sb.Append(@" (modified)");
            else
                sb.Append(@" (unchanged)");
            sb.Append(@"
  LastModified = " + (LastModified.HasValue ? LastModified.Value.ToString() : "null") + @"");
            if (IsLastModifiedModified)
                sb.Append(@" (modified)");
            else
                sb.Append(@" (unchanged)");
            sb.Append(@"
  AdminID = '" + (AdminID != null ? AdminID : "null") + @"'");
            if (IsAdminIDModified)
                sb.Append(@" (modified)");
            else
                sb.Append(@" (unchanged)");
            sb.Append(@"
");
            return sb.ToString();
        }

    }

    ///<summary>
    ///The result of an add or update of type <see cref="UsersInRole" />.
    ///</summary>
    [DataContract]
    [Serializable]
    public class UsersInRoleUpdateResult : IUpdateResult
    {
        /// <summary>
        /// Status of add, update or delete operation
        /// </summary>
        [DataMember]
        public int OpStatus
        {
            get { return _opStatus; }
            set { _opStatus = value; }
        }
        private int _opStatus = (int)EntityOpStatus.Unknown;

        /// <summary>
        /// Parents or child operation status
        /// </summary>
        [DataMember]
        public int RelatedOpStatus
        {
            get { return _relatedOpStatus; }
            set { _relatedOpStatus = value; }
        }
        private int _relatedOpStatus = (int)EntityOpStatus.Unknown;

        /// <summary>
        /// The updated entity.
        /// </summary>
        [DataMember]
        public UsersInRole UpdatedItem
        {
            get;
            set;
        }

        /// <summary>
        /// If the relational data source has a way of detecting concurrent update conflicts, this is the item inside the
        /// data source that had been updated by other agents in between the load and update time interval of the present
        /// agent. The client software should resolve the conflict.
        /// </summary>
        [DataMember]
        public UsersInRole ConflictItem
        {
            get;
            set;
        }

        /// <summary>
        /// String representation of the entity.
        /// </summary>
        public string EntityInfo 
        { 
            get { return UpdatedItem == null ? "NULL" : UpdatedItem.ToString(); }
        }
    }

}
